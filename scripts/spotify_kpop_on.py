import os import pandas as pd from datetime import datetime import pytz import requests from bs4 import BeautifulSoup import base64 # Spotify K-Pop ON! 플레이리스트 URL playlist_url = "https://open.spotify.com/playlist/37i9dQZF1DX9tPFwDMOaN1" headers = {"User-Agent": "Mozilla/5.0"} res = requests.get(playlist_url, headers=headers) if res.status_code != 200: raise Exception(f"페이지 요청 실패: {res.status_code}") html = res.text soup = BeautifulSoup(html, "html.parser") tracks = [] track_elements = soup.find_all("div", {"class": "tracklist-row__name"}) for i, elem in enumerate(track_elements, start=1): title_elem = elem.find("span") title = title_elem.get_text(strip=True) if title_elem else "알 수 없음" artist_elem = elem.find_next_sibling("a") artists = artist_elem.get_text(strip=True) if artist_elem else "알 수 없음" added_at = "알 수 없음" tracks.append([i, title, artists, added_at]) # spotify 폴더 자동 생성 output_dir = "spotify" os.makedirs(output_dir, exist_ok=True) kst = pytz.timezone("Asia/Seoul") date_str = datetime.now(kst).strftime("%Y-%m-%d") file_name = f"spotify_kpop_on_{date_str}.xlsx" file_path = os.path.join(output_dir, file_name) df = pd.DataFrame(tracks, columns=["순서", "제목", "아티스트명", "추가한 날짜"]) df.to_excel(file_path, index=False) print(f"Saved: {file_path}") # ----------------------------- # GitHub 업로드 (API 방식) # ----------------------------- GITHUB_REPO = "jongwoo-cho/melon" # 본인 repo GITHUB_BRANCH = "main" GITHUB_TOKEN = os.environ.get("GITHUB_TOKEN") if not GITHUB_TOKEN: raise Exception("GITHUB_TOKEN 환경변수 필요!") with open(file_path, "rb") as f: content = f.read() b64_content = base64.b64encode(content).decode() api_url = f"https://api.github.com/repos/{GITHUB_REPO}/contents/spotify/{file_name}" # 파일 존재 여부 확인 r = requests.get(api_url, headers={"Authorization": f"token {GITHUB_TOKEN}"}) if r.status_code == 200: sha = r.json()["sha"] else: sha = None data = { "message": f"Daily Spotify scrape - {date_str}", "branch": GITHUB_BRANCH, "content": b64_content, } if sha: data["sha"] = sha resp = requests.put(api_url, headers={"Authorization": f"token {GITHUB_TOKEN}"}, json=data) if resp.status_code not in [200, 201]: raise Exception(f"GitHub 업로드 실패: {resp.status_code}, {resp.text}") print(f"Uploaded {file_name} to GitHub")
